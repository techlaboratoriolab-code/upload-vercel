<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S3 Backup Manager</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #000000 0%, #1a1a1a 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-bottom: 3px solid #444;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .status-bar {
            background: #1a1a1a;
            padding: 15px 30px;
            border-bottom: 2px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #ccc;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #28a745;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .content {
            padding: 30px;
            background: #2d2d2d;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-option {
            background: linear-gradient(135deg, #1a1a1a 0%, #333 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #444;
            font-size: 16px;
            text-align: left;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
        }

        .menu-option:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.5);
            border-color: #666;
            background: linear-gradient(135deg, #222 0%, #3a3a3a 100%);
        }

        .menu-option:active {
            transform: translateY(-2px);
        }

        .menu-option .icon {
            font-size: 2.5em;
            margin-bottom: 15px;
        }

        .menu-option .title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .menu-option .description {
            opacity: 0.9;
            font-size: 0.95em;
        }

        .result-area {
            background: #1a1a1a;
            border-radius: 10px;
            padding: 20px;
            min-height: 200px;
            max-height: 500px;
            overflow-y: auto;
            display: none;
            border: 2px solid #333;
        }

        .result-area.show {
            display: block;
        }

        .result-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #fff;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #555;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #aaa;
            font-size: 1.2em;
        }

        .spinner {
            border: 4px solid #333;
            border-top: 4px solid #666;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .backup-item {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #555;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
        }

        .backup-item .name {
            font-weight: bold;
            color: #fff;
            margin-bottom: 5px;
        }

        .backup-item .details {
            color: #aaa;
            font-size: 0.9em;
        }

        .backup-item .download-btn {
            background: #444;
            color: white;
            border: 1px solid #666;
            padding: 8px 15px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 0.9em;
            transition: all 0.3s ease;
        }

        .backup-item .download-btn:hover {
            background: #555;
            border-color: #888;
        }

        .success-message {
            background: #2d2d2d;
            color: #90ee90;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4a4a4a;
            margin-bottom: 15px;
        }

        .error-message {
            background: #2d2d2d;
            color: #ff6b6b;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4a4a4a;
            margin-bottom: 15px;
        }

        .info-box {
            background: #2d2d2d;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.3);
            border: 1px solid #444;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #3a3a3a;
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            font-weight: bold;
            color: #888;
        }

        .info-value {
            color: #ccc;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üì¶ S3 Backup Manager</h1>
            <p>Gerenciador de Backups AWS S3</p>
        </div>

        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="statusText">Verificando status...</span>
            </div>
            <div id="bucketInfo" style="color: #888; font-size: 0.9em;"></div>
        </div>

        <div class="content">
            <div class="menu-grid">
                <button class="menu-option" onclick="verificarStatus()">
                    <div class="icon">üîç</div>
                    <div class="title">Verificar Status</div>
                    <div class="description">Verifica se o servi√ßo S3 est√° funcionando corretamente</div>
                </button>

                <button class="menu-option" onclick="listarBackups()">
                    <div class="icon">üìã</div>
                    <div class="title">Listar Backups</div>
                    <div class="description">Mostra todos os backups dispon√≠veis no S3</div>
                </button>

                <button class="menu-option" onclick="verBackupMaisRecente()">
                    <div class="icon">‚≠ê</div>
                    <div class="title">Backup Mais Recente</div>
                    <div class="description">Exibe informa√ß√µes do backup mais recente</div>
                </button>

                <button class="menu-option" onclick="baixarBackupMaisRecente()">
                    <div class="icon">‚¨áÔ∏è</div>
                    <div class="title">Baixar Mais Recente</div>
                    <div class="description">Baixa automaticamente o backup mais recente</div>
                </button>
            </div>

            <div id="resultArea" class="result-area">
                <div class="result-title" id="resultTitle"></div>
                <div id="resultContent"></div>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8080';

        // Verifica status ao carregar a p√°gina
        window.addEventListener('load', () => {
            verificarStatusInicial();
        });

        async function verificarStatusInicial() {
            try {
                const response = await fetch(`${API_URL}/status`);
                const data = await response.json();

                if (data.status === 'online') {
                    document.getElementById('statusText').textContent = 'Servi√ßo Online';
                    document.getElementById('bucketInfo').textContent = `Bucket: ${data.bucket} | Regi√£o: ${data.region}`;
                } else {
                    document.getElementById('statusText').textContent = 'Servi√ßo Offline';
                    document.querySelector('.status-dot').style.background = '#dc3545';
                }
            } catch (error) {
                document.getElementById('statusText').textContent = 'Erro ao conectar';
                document.querySelector('.status-dot').style.background = '#dc3545';
            }
        }

        function showLoading(title) {
            const resultArea = document.getElementById('resultArea');
            const resultTitle = document.getElementById('resultTitle');
            const resultContent = document.getElementById('resultContent');

            resultTitle.textContent = title;
            resultContent.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    <div>Processando...</div>
                </div>
            `;
            resultArea.classList.add('show');
        }

        function showError(message) {
            const resultContent = document.getElementById('resultContent');
            resultContent.innerHTML = `
                <div class="error-message">
                    <strong>Erro:</strong> ${message}
                </div>
            `;
        }

        async function verificarStatus() {
            showLoading('Status do Servi√ßo');

            try {
                const response = await fetch(`${API_URL}/status`);
                const data = await response.json();

                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = `
                    <div class="success-message">
                        <strong>‚úÖ Servi√ßo funcionando corretamente!</strong>
                    </div>
                    <div class="info-box">
                        <div class="info-row">
                            <span class="info-label">Status:</span>
                            <span class="info-value">${data.status}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Bucket:</span>
                            <span class="info-value">${data.bucket}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Regi√£o:</span>
                            <span class="info-value">${data.region}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Mensagem:</span>
                            <span class="info-value">${data.message}</span>
                        </div>
                    </div>
                `;
            } catch (error) {
                showError(error.message);
            }
        }

        async function listarBackups() {
            showLoading('Lista de Backups');

            try {
                const response = await fetch(`${API_URL}/backups`);
                const data = await response.json();

                if (!data.success) {
                    showError(data.error);
                    return;
                }

                const resultContent = document.getElementById('resultContent');

                if (data.backups.length === 0) {
                    resultContent.innerHTML = `
                        <div class="error-message">
                            Nenhum backup encontrado no bucket.
                        </div>
                    `;
                    return;
                }

                let html = `
                    <div class="success-message">
                        <strong>‚úÖ ${data.total} backup(s) encontrado(s)</strong>
                    </div>
                `;

                data.backups.forEach(backup => {
                    const sizeMB = (backup.Size / (1024 * 1024)).toFixed(2);
                    const date = new Date(backup.LastModified).toLocaleString('pt-BR');

                    html += `
                        <div class="backup-item">
                            <div class="name">üì¶ ${backup.FileName}</div>
                            <div class="details">
                                üìä Tamanho: ${sizeMB} MB<br>
                                üìÖ Data: ${date}
                            </div>
                            <button class="download-btn" onclick="baixarBackupEspecifico('${backup.Key}')">
                                ‚¨áÔ∏è Baixar este backup
                            </button>
                        </div>
                    `;
                });

                resultContent.innerHTML = html;
            } catch (error) {
                showError(error.message);
            }
        }

        async function verBackupMaisRecente() {
            showLoading('Backup Mais Recente');

            try {
                const response = await fetch(`${API_URL}/backup/latest`);
                const data = await response.json();

                if (!data.success) {
                    showError(data.error);
                    return;
                }

                const backup = data.backup;
                const sizeMB = (backup.Size / (1024 * 1024)).toFixed(2);
                const date = new Date(backup.LastModified).toLocaleString('pt-BR');

                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = `
                    <div class="success-message">
                        <strong>‚úÖ Backup mais recente encontrado!</strong>
                    </div>
                    <div class="info-box">
                        <div class="info-row">
                            <span class="info-label">Nome:</span>
                            <span class="info-value">${backup.FileName}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tamanho:</span>
                            <span class="info-value">${sizeMB} MB</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Data:</span>
                            <span class="info-value">${date}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Chave S3:</span>
                            <span class="info-value">${backup.Key}</span>
                        </div>
                    </div>
                    <button class="download-btn" style="width: 100%; margin-top: 15px; padding: 12px;" onclick="baixarBackupEspecifico('${backup.Key}')">
                        ‚¨áÔ∏è Baixar este backup agora
                    </button>
                `;
            } catch (error) {
                showError(error.message);
            }
        }

        async function baixarBackupMaisRecente() {
            showLoading('Baixando Backup Mais Recente');

            try {
                const response = await fetch(`${API_URL}/backup/download/latest`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (!data.success) {
                    showError(data.error);
                    return;
                }

                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = `
                    <div class="success-message">
                        <strong>‚úÖ Download conclu√≠do com sucesso!</strong>
                    </div>
                    <div class="info-box">
                        <div class="info-row">
                            <span class="info-label">Arquivo:</span>
                            <span class="info-value">${data.arquivo}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tamanho:</span>
                            <span class="info-value">${data.tamanho_mb} MB</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tempo:</span>
                            <span class="info-value">${data.tempo_segundos} segundos</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Velocidade:</span>
                            <span class="info-value">${data.velocidade_mb_s} MB/s</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Salvo em:</span>
                            <span class="info-value">${data.caminho_local}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Data modifica√ß√£o:</span>
                            <span class="info-value">${new Date(data.data_modificacao).toLocaleString('pt-BR')}</span>
                        </div>
                    </div>
                `;
            } catch (error) {
                showError(error.message);
            }
        }

        async function baixarBackupEspecifico(arquivoKey) {
            showLoading('Baixando Backup');

            try {
                const response = await fetch(`${API_URL}/backup/download`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ arquivoKey: arquivoKey })
                });

                const data = await response.json();

                if (!data.success) {
                    showError(data.error);
                    return;
                }

                const resultContent = document.getElementById('resultContent');
                resultContent.innerHTML = `
                    <div class="success-message">
                        <strong>‚úÖ Download conclu√≠do com sucesso!</strong>
                    </div>
                    <div class="info-box">
                        <div class="info-row">
                            <span class="info-label">Arquivo:</span>
                            <span class="info-value">${data.arquivo}</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tamanho:</span>
                            <span class="info-value">${data.tamanho_mb} MB</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Tempo:</span>
                            <span class="info-value">${data.tempo_segundos} segundos</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Velocidade:</span>
                            <span class="info-value">${data.velocidade_mb_s} MB/s</span>
                        </div>
                        <div class="info-row">
                            <span class="info-label">Salvo em:</span>
                            <span class="info-value">${data.caminho_local}</span>
                        </div>
                    </div>
                `;
            } catch (error) {
                showError(error.message);
            }
        }
    </script>
</body>
</html>
